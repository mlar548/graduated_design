// JavaScript Document
/**
 * This jQuery plugin displays pagination links inside the selected elements.
 *
 * @author Gabriel Birke (birke *at* d-scribe *dot* de)
 * @version 1.2
 * @param {int} maxentries Number of entries to paginate
 * @param {Object} opts Several options (see README for documentation)
 * @return {Object} jQuery Object
 */
jQuery.fn.pagination = function (maxentries, opts) {
    opts = jQuery.extend({
        items_per_page: 10,
        num_display_entries: 10,
        current_page: 0,
        num_edge_entries: 0,
        link_to: "#",
        prev_text: "Prev",
        next_text: "Next",
        ellipse_text: "...",
        prev_show_always: true,
        next_show_always: true,
        callback: function () { return false; }
    }, opts || {});

    return this.each(function () {
        /**
		 * 计算最大分页显示数目
		 */
        function numPages() {
            return Math.ceil(maxentries / opts.items_per_page);
        }
        /**
		 * 极端分页的起始和结束点，这取决于current_page 和 num_display_entries.
		 * @返回 {数组(Array)}
		 */
        function getInterval() {
            var ne_half = Math.ceil(opts.num_display_entries / 2);
            var np = numPages();
            var upper_limit = np - opts.num_display_entries;
            var start = current_page > ne_half ? Math.max(Math.min(current_page - ne_half, upper_limit), 0) : 0;
            var end = current_page > ne_half ? Math.min(current_page + ne_half, np) : Math.min(opts.num_display_entries, np);
            return [start, end];
        }

        /**
		 * 分页链接事件处理函数
		 * @参数 {int} page_id 为新页码
		 */
        function pageSelected(page_id, evt) {
            current_page = page_id;
            drawLinks();
            var continuePropagation = opts.callback(page_id, panel);
            if (!continuePropagation) {
                if (evt.stopPropagation) {
                    evt.stopPropagation();
                }
                else {
                    evt.cancelBubble = true;
                }
            }
            return continuePropagation;
        }

        /**
		 * 此函数将分页链接插入到容器元素中
		 */
        function drawLinks() {
            panel.empty();
            var interval = getInterval();
            var np = numPages();
            // 这个辅助函数返回一个处理函数调用有着正确page_id的pageSelected。
            var getClickHandler = function (page_id) {
                return function (evt) { return pageSelected(page_id, evt); }
            }
            //辅助函数用来产生一个单链接(如果不是当前页则产生span标签)
            var appendItem = function (page_id, appendopts) {
                page_id = page_id < 0 ? 0 : (page_id < np ? page_id : np - 1); // 规范page id值
                appendopts = jQuery.extend({ text: page_id + 1, classes: "" }, appendopts || {});
                if (page_id == current_page) {
                    var lnk = jQuery("<span class='current'>" + (appendopts.text) + "</span>");
                } else {
                    var lnk = jQuery("<a>" + (appendopts.text) + "</a>")
						.bind("click", getClickHandler(page_id))
						.attr('href', opts.link_to.replace(/__id__/, page_id));
                }
                if (appendopts.classes) { lnk.addClass(appendopts.classes); }
                panel.append(lnk);
            }
            // 产生"Previous"-链接
            if (opts.prev_text && (current_page > 0 || opts.prev_show_always)) {
                appendItem(current_page - 1, { text: opts.prev_text, classes: "prev" });
            }
            // 产生起始点
            if (interval[0] > 0 && opts.num_edge_entries > 0) {
                var end = Math.min(opts.num_edge_entries, interval[0]);
                for (var i = 0; i < end; i++) {
                    appendItem(i);
                }
                if (opts.num_edge_entries < interval[0] && opts.ellipse_text) {
                    jQuery("<span>" + opts.ellipse_text + "</span>").appendTo(panel);
                }
            }
            // 产生内部的些链接
            for (var i = interval[0]; i < interval[1]; i++) {
                appendItem(i);
            }
            // 产生结束点
            if (interval[1] < np && opts.num_edge_entries > 0) {
                if (np - opts.num_edge_entries > interval[1] && opts.ellipse_text) {
                    jQuery("<span>" + opts.ellipse_text + "</span>").appendTo(panel);
                }
                var begin = Math.max(np - opts.num_edge_entries, interval[1]);
                for (var i = begin; i < np; i++) {
                    appendItem(i);
                }

            }
            // 产生 "Next"-链接
            if (opts.next_text && (current_page < np - 1 || opts.next_show_always)) {
                appendItem(current_page + 1, { text: opts.next_text, classes: "next" });
            }
        }

        //从选项中提取current_page
        var current_page = opts.current_page;
        //创建一个显示条数和每页显示条数值
        maxentries = (!maxentries || maxentries < 0) ? 1 : maxentries;
        opts.items_per_page = (!opts.items_per_page || opts.items_per_page < 0) ? 1 : opts.items_per_page;
        //存储DOM元素，以方便从所有的内部结构中获取
        var panel = jQuery(this);
        // 获得附加功能的元素
        this.selectPage = function (page_id) { pageSelected(page_id); }
        this.prevPage = function () {
            if (current_page > 0) {
                pageSelected(current_page - 1);
                return true;
            }
            else {
                return false;
            }
        }
        this.nextPage = function () {
            if (current_page < numPages() - 1) {
                pageSelected(current_page + 1);
                return true;
            }
            else {
                return false;
            }
        }
        // 所有初始化完成，绘制链接
        drawLinks();
        // 回调函数
        opts.callback(current_page, this);
    });
}


////////////////////////////////
var _p = {};
_p.isclickgotoTop = false;
var _v30 = {
    isexpand: false,
    normalSlider: function (obj, eventType, effect, isauto, delay, isShowNum) {
        obj = $(obj);
        var isOver = true;
        var _index = 0;
        var subobj = obj.find("ul");
        var subobj_li = subobj.find("li");
        var _width = subobj_li.width();
        var _height = subobj_li.height();
        var current = 0;
        eventType = eventType || "mouseover";
        effect = effect || "no";
        isauto = isauto || true;
        delay = delay || 3000;
        isShowNum = isShowNum || false;
        var _timer = null;
        var _length = subobj_li.length;
        var prv = obj.find(".prv");
        var next = obj.find(".next");
        var _init = function () {
            if (effect == "fade") {
                subobj_li.css({ "zIndex": "1", "float": "none", "left": "0", "top": "0" }).eq(0).css("zIndex", "2");
            }
            if (_length > 1) {
                if (isauto) {
                    clearInterval(_timer);
                    _timer = setInterval(function () {
                        if (isOver) {
                            if (current + 1 >= _length)
                                current = 0;
                            else
                                current++;
                            _slider();
                        }
                    }, delay);
                }
                _event();
                _mousehover();
            } //如果数量>1自动轮播
            _showCtrlNum();
        }
        var _showCtrlNum = function () {
            var _ctrl = "";
            if (isShowNum) {
                if (_length > 1) {
                    for (var i = 1; i <= _length; i++) {
                        _ctrl += "<a href='javascript:;'>" + i + "</a>";
                    }
                    $(obj).find(".ctrl").html(_ctrl);
                    $(obj).find(".ctrl a").eq(0).addClass("curr");
                    //click event
                    $(obj).find(".ctrl a").live("click", function () {
                        clearInterval(_timer);
                        $(obj).find(".ctrl a").removeClass("curr");
                        current = $(this).index();
                        _slider();
                        _timer = setInterval(function () {
                            if (isOver) {
                                if (current + 1 >= _length)
                                    current = 0;
                                else
                                    current++;
                                _slider();
                            }
                        }, delay);
                        $(this).addClass("curr");
                    });
                }
            }
        }
        var _event = function () {
            prv.bind(eventType, function () {
                clearInterval(_timer)
                if (current == 0)
                    current = _length - 1;
                else
                    current--;
                _slider();

                _timer = setInterval(function () {
                    if (isOver) {
                        if (current + 1 >= _length)
                            current = 0;
                        else
                            current++;
                        _slider();
                    }
                }, delay);
            });
            next.bind(eventType, function () {
                clearInterval(_timer)
                if (current >= _length - 1)
                    current = 0;
                else
                    current++;
                _slider();
                _timer = setInterval(function () {
                    if (isOver) {
                        if (current + 1 >= _length)
                            current = 0;
                        else
                            current++;
                        _slider();
                    }
                }, delay);
            });
        }
        var _slider = function () {
            $(obj).find(".ctrl a").removeClass("curr").eq(current).addClass("curr");
            if (effect == "no") {
                //obj_li.removeClass("curr").eq(current).addClass("curr");
                subobj_li.hide().eq(current).show();
            }
            else if (effect == "slider") {
                //alert(subobj.html());
                subobj.css("width", _length * _width);
                //obj_li.removeClass("curr").eq(current).addClass("curr");
                subobj_li.css("display", "block");
                subobj.stop(false, true).animate({
                    marginLeft: -1 * _width * current + "px"
                }, 500);
            }
            else if (effect == "top") {
                subobj.css("height", _length * _height);
                //obj_li.removeClass("curr").eq(current).addClass("curr");
                subobj_li.css({ "display": "block", "float": "none" });
                subobj.stop(true, true).animate({
                    marginTop: -1 * _height * current + "px"
                }, 500);
            }
            else if (effect == "fade") {
                //obj_li.removeClass("curr").eq(current).addClass("curr");
                subobj_li.css({ "position": "absolute", "display": "block" }).stop(true, true).animate({
                    opacity: 0, zIndex: 1
                }, 800);
                subobj_li.eq(current).stop(true, true).animate({
                    opacity: 1, zIndex: 2
                }, 800);
            }
        }
        var _stopTimer = null;
        var _mousehover = function () {
            obj.hover(
					function () {
					    obj.find(".controler").stop(true, true).animate({ opacity: 1 }, "fast");
					    //clearInterval(_timer);
					    isOver = false;
					},
					function () {
					    obj.find(".controler").stop(true, true).animate({ opacity: 0 }, "fast");
					    isOver = true;
					}
				);
        }
        _init();
    }, //slider end
    _jcSlider: function (sliderobj, visible, prvbtn, nextbtn) {
        var liobj = sliderobj.find("li");
        var ulobj = sliderobj.find("ul");
        var width = "";
        var li_length = liobj.length;
        var step = 1;
        var count = 0; width = li_length * liobj.outerWidth(true);
        ulobj.css({ "width": width + "px", "position": "relative" });
        var _init = function () {
            if (li_length <= visible) {
                return;
            } else {
                step = Math.ceil(li_length / visible);
            }
        };
        var _slider = function (type) {
            if (li_length > visible) {
                if (type == "prv") {
                    if (count <= 0) {
                        count = step - 1;
                    } else {
                        count--;
                    }
                    ulobj.stop(true, false).animate({
                        "left": visible * liobj.outerWidth(true) * count * -1 + "px"
                    }, 1000);
                }
                if (type == "next") {
                    if (count >= step - 1) {
                        count = 0;
                    } else {
                        count++;
                    }
                    ulobj.stop(true, false).animate({
                        "left": visible * liobj.outerWidth(true) * count * -1 + "px"
                    }, 1000);
                }
            }
            else {
                return;
            }
        };
        _init();
        $(prvbtn).bind("click", function () {
            _slider("prv");
        });
        $(nextbtn).bind("click", function () {
            _slider("next");
        });
    },
    _topAd: function (obj, showtime, delay) {
        var _slideDown = null;
        var _slideUp = null;
        if (delay == undefined || delay == null)
            delay = 5000;
        else
            delay = delay * 1000;
        if (showtime == undefined || showtime == null)
            showtime = 5000;
        else
            showtime = showtime * 1000;

        var imgDefaultHeight = obj.height();
        var imgFullHeight = 0;
        clearTimeout(_slideDown);
        _slideDown = setTimeout(function () {
            imgFullHeight = obj.find("img:first").height()
            if (imgFullHeight > imgDefaultHeight) {
                obj.stop(true, true).animate({
                    height: imgFullHeight + "px"
                }, "1000", function () {
                    clearTimeout(_slideUp);
                    _slideUp = setTimeout(function () {
                        obj.stop(true, true).animate({ height: imgDefaultHeight + "px" }, "1000", function () { obj.find("i").fadeIn("fast"); });
                    }, delay);
                });
            }
        }, showtime);
    },
    _showHide: function (obj, subobj, delay, speed, animate) {
        var timer = null;
        var _fn = {
            _init: function () {
                _fn._show();
                _fn._hide();
            },
            _show: function () {
                obj.on("mouseover", function () {
                    clearTimeout(timer);
                    var _t = $(this);
                    timer = setTimeout(function () {
                        _t.addClass("hover");
                        if (animate == "normal") {
                            subobj.stop(true, true).show();
                        }
                        else if (animate == "slidedown") {
                            subobj.stop(true, true).slideDown(speed);
                        }
                        else {
                            return true;
                        }
                    }, delay);
                });
                subobj.on("mouseover", function () {
                    clearTimeout(timer);
                    timer = setTimeout(function () {
                        if (animate == "normal" || animate == "slidedown")
                            subobj.stop(true, true).show();
                    }, delay);
                });
            },
            _hide: function () {
                obj.on("mouseout", function () {
                    clearTimeout(timer);
                    var _t = $(this);
                    timer = setTimeout(function () {
                        _t.removeClass("hover");
                        if (animate == "normal" || animate == "slidedown")
                            subobj.stop(true, true).hide();
                    }, delay);
                });
                subobj.on("mouseout", function () {
                    clearTimeout(timer);
                    timer = setTimeout(function () {
                        if (animate == "normal" || animate == "slidedown")
                            subobj.stop(true, true).hide();
                    }, delay);
                });
            }
        }
        _fn._init();
    },
    _tab: function (obj, subobj, eventType, delay) {
        var timer = null;
        obj = $(obj);
        subobj = $(subobj);
        obj.first().addClass("curr");
        subobj.first().addClass("ecs_show");
        //fun
        obj.bind(eventType, function () {
            var $t = $(this);
            var $t_index = $t.index();
            if (eventType == "mouseover") {
                window.clearTimeout(timer);
                timer = window.setTimeout(function () {
                    obj.removeClass("curr");
                    $t.addClass("curr");
                    subobj.removeClass("ecs_hide ecs_show").addClass("ecs_hide");
                    subobj.eq($t_index).removeClass("ecs_hide");
                }, delay);
            }
            else {
                subobj.removeClass("ecs_hide ecs_show").addClass("ecs_hide");
                subobj.eq($t_index).removeClass("ecs_hide");
            }
        });
    },
    _hotRank: function (obj, delay) {
        var timer = null;
        obj.eq(0).addClass("hover");
        obj.each(function (num) {
            num++;
            $(this).find("s").text(num);
            if (num > 3)
                $(this).addClass("out");
        });
        obj.bind("mouseover", function () {
            var _t = $(this);
            clearTimeout(timer);
            timer = setTimeout(function () {
                obj.removeClass("hover");
                _t.addClass("hover");
            }, delay);
        });
    },
    _synHeight: function (obj) {
        var height = 0;
        var _thisHeight
        $(obj).each(function () {
            _thisHeight = $(this).outerHeight(true);
            if (_thisHeight > height)
                height = _thisHeight
        });
        $(obj).css("height", height + "px");
    },
    _changeImg: function (obj, event) {
        obj = $(obj);
        obj.first().addClass("clickboder");
        obj.bind(event, function () {
            var $t = $(this);
            var t_smallimg = $t.find("img");
            var t_bigimg = $(".proinfo_scrollimg .big img");
            obj.removeClass("clickboder");
            $t.addClass("clickboder");
            if (t_smallimg.attr("src").indexOf("http://") > -1) {
                t_bigimg.attr("src", t_smallimg.attr("src").replace("80x80.jpg", "350x350.jpg"));
            }
            else {
                t_bigimg.attr("src", t_smallimg.attr("src").replace("80x80.jpg", "510x510.jpg"));
            }
        });
    },
    _categories: {
        _init: function () {
            $(".top_categorys .mc  .item").each(function (e) {
                if (e > 12) {
                    $(this).css("display", "none");
                }
            });
            //$(".top_categorys .mc  .item").each(function () {
            //    if ($(this).index() >= 11) {
            //        $(this).addClass("overtop");
            //    }
            //});
            $(".categories .item").each(function (i) {
                if (i >= 11) {
                    $(this).addClass("overtop");
                }
            });
            var timer = null;
            $("#top_categorys,#top_categorys .mc").hover(
                function () {
                    if ($("body#root").length > 0) {
                        return;
                    }
                    else {
                        clearTimeout(timer);
                        timer = setTimeout(function () {
                            $("#top_categorys .mc").show();
                        }, 300);
                    }
                },
                function () {
                    if ($("body#root").length > 0) {
                        return;
                    }
                    else {
                        clearTimeout(timer);
                        timer = setTimeout(function () {
                            $("#top_categorys .mc").hide();
                        }, 300);
                    }
                }
            );
        },
        _over: function (obj, event) {
            obj = $(obj);
            obj.addClass("hover");
            console.log(event.target);
        },
        _out: function (obj, event) {
            obj = $(obj);
            obj.removeClass("hover");
        }
    },
    addToFavorite: function (c) {
        var d = "http://" + document.location.host + "/";
        //var c = "加入收藏夹";
        c = $("title").text();
        try {
            window.external.AddFavorite(d, c);
        } catch (e) {
            try {
                window.sidebar.addPanel(c, d, "");
            } catch (e) {
                alert("对不起，您的浏览器不支持此操作!\n请您使用菜单栏或Ctrl+D收藏本站。");
            }
        }
    }, //收藏夹 IE内核
    ShareTo: function (webName) {
        var url = "";
        var title = $(".product_t").find("font").html(); //商品标题
        var content = title; //推广内容
        var productUrl = window.location.href; //网站访问地址
        var img = $(".zoomimg").attr("src");  //商品图片地址
        switch (webName) {
            case "tsina":
                url = "http://v.t.sina.com.cn/share/share.php?url=" + productUrl + "&title=" + content;
                break;
            case "kaixin001":
                url = "http://www.kaixin001.com/repaste/share.php?" + "rtitle=" + content + "&rcontent=" + title + productUrl + "&rurl=" + productUrl;
                break;
            case "gmail":
                url = "https://mail.google.com/mail/?view=cm&fs=1&tf=1&ui=2&shva=1&to&su=" + title + "&body=" + productUrl;
                break;
            case "renren":
                url = "http://share.renren.com/share/buttonshare.do?link=" + productUrl + "&title=" + title;
                break;
            case "qq":
                url = "http://shuqian.qq.com/post?from=3&title=" + encodeURIComponent(title) + "&uri=" + productUrl + "&jumpback=2&noui=1"
                break;
            case "qqblog":
                url = "http://v.t.qq.com/share/share.php?site=" + productUrl + "&title=" + encodeURIComponent(title) + "&pic=" + img + "&url=" + productUrl
                break;
            case "qzone":
                var url = "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=" + encodeURIComponent(productUrl)
                break;
            case "baidu":
                url = "http://cang.baidu.com/do/add?it=" + encodeURIComponent(title) + "&iu=" + encodeURIComponent(productUrl) + "&fr=ien#nw=1";
                break;
            case "douban":
                //url="http://www.douban.com/recommend/?title="+title+"&comment="+content+"&url="+productUrl;
                url = 'http://www.douban.com/recommend/?url=' + productUrl + '&title=' + encodeURIComponent(title);
                break;
            case "google":
                //url="http://www.google.com/reader/link?url='"+productUrl+"'&title='"+title+"'&srcURL="+img+"'";
                url = "http://www.google.com/bookmarks/mark?op=edit&hl=zh-CN&output=popup&bkmk=" + productUrl + "&title=" + title;
                break;
            case "taojianghu":
                url = "http://share.jianghu.taobao.com/share/addShare.htm?url=" + productUrl + "&title=" + title;
                break;
            case "vivi":
                url = "http://vivi.sina.com.cn/collect/icollect.php?title=" + escape(title) + "&url=" + escape(productUrl) + "&desc=" + escape(content);
                break;
            case "51":
                url = "http://share.51.com/share/share.php?type=8&title=" + encodeURIComponent(title) + "&vaddr=" + encodeURIComponent(productUrl);
                break;
            case "yahoo":
                url = "http://myweb.cn.yahoo.com/popadd.html?url=" + encodeURIComponent(productUrl) + "&title=" + encodeURIComponent(title);
                break;
            case "bai":
                url = "http://bai.sohu.com/appLogin.jsp?bru=/app/share/blank/add.do?link=" + productUrl + "&title=" + title;
                break;
            case "msn":
                url = "http://profile.live.com/badge/?url=" + encodeURIComponent(productUrl) + "&title=" + encodeURIComponent(title) + "&description=" + encodeURIComponent(content) + "&screenshot=" + img;
                break;
            default:
                break;
        }
        window.open(url, "_blank");
    },
    _jcarousellite: function (_obj, _speed, _auto, _visible, _vertical) {
        if ($(_obj).length != 0 && $(_obj).find("li").length >= _visible) {
            _obj.find(".controler").show();
            _obj.parent().find(".next").show();
            _obj.parent().find(".prv").show();
            $(_obj).jCarouselLite({
                btnNext: _obj.parent().find(".next"),
                btnPrev: _obj.parent().find(".prv"),
                speed: _speed,
                auto: _auto,
                visible: _visible,
                vertical: _vertical || false
            });
        }
    },
    _buytab: function (obj, delay) {
        var timer = null;
        delay = delay || 300;
        var tab_obj = obj.find(".ptab").find("li");
        var hold_obj = obj.find(".phold");
        tab_obj.bind("mouseover", function () {
            var _this = $(this);
            clearTimeout(timer);
            timer = setTimeout(function () {
                tab_obj.removeClass("curr");
                hold_obj.hide();
                _this.addClass("curr");
                hold_obj.eq(_this.index()).show();
            }, delay);
        }); //over event
    },
    productTabtimer: null,
    newbuytabChange_forold: function (obj, _eid, _tab) {
        obj = $(obj);
        var productTabtimer = null;
        clearTimeout(productTabtimer);
        productTabtimer = setTimeout(
            function () {
                $("#temp_" + _eid + "ECS362 li").removeClass("curr");
                obj.addClass("curr");

                if ($("#tab" + _tab + _eid).html() == null) {
                    $.ajax({
                        url: '../controls/controls_data_load.ashx',
                        async: false,
                        type: 'POST',
                        data: { type: "ECbuytab", eid: _eid, tab: _tab },
                        dataType: 'html',
                        success: function (data) {
                            $("#tab0" + _eid).hide();
                            $("#tab1" + _eid).hide();
                            $("#tab2" + _eid).hide();
                            $("#tab3" + _eid).hide();
                            $("#tab4" + _eid).hide();
                            $("#temp_" + _eid + "ECS362").after(data);
                            $("#tab" + _tab + _eid).show();
                        }
                    });
                }
                else {
                    $("#tab0" + _eid).hide();
                    $("#tab1" + _eid).hide();
                    $("#tab2" + _eid).hide();
                    $("#tab3" + _eid).hide();
                    $("#tab4" + _eid).hide();
                    $("#tab" + _tab + _eid).show();
                }
                arrow.stop(true, true).animate({
                    left: _tab * obj.width() + "px"
                }, "fast");
            }, 150);
    },
    newbuytabChange: function (obj, _eid, _tab, flag) {
        obj = $(obj);
        var arrow = obj.parent().parent().parent().find(".tab-arrow");
        var productTabtimer = null;
        clearTimeout(productTabtimer);
        productTabtimer = setTimeout(
            function () {
                $("#temp_" + _eid + "ECS362 .ptab li").removeClass("curr");
                obj.addClass("curr");
                if ($("#tab" + _tab + _eid).html() == null) {
                    $.ajax({
                        url: '../controls/controls_data_load.ashx',
                        async: false,
                        type: 'POST',
                        data: { type: "buytab_1", eid: _eid, tab: _tab },
                        dataType: 'html',
                        success: function (data) {
                            $("#tab0" + _eid).hide();
                            $("#tab1" + _eid).hide();
                            $("#tab2" + _eid).hide();
                            $("#tab3" + _eid).hide();
                            $("#tab4" + _eid).hide();
                            if (flag) {
                                $("#temp_" + _eid + "ECS362 .ptab").after(data);
                            }
                            else {
                                $("#temp_" + _eid + "ECS362").after(data);
                            }
                            $("#tab" + _tab + _eid).show();
                            // _v30._jcarousellite($("#tab" + _tab + _eid).find(".hold"), 1000, false, 4, false);
                        }
                    });
                }
                else {
                    $("#tab0" + _eid).hide();
                    $("#tab1" + _eid).hide();
                    $("#tab2" + _eid).hide();
                    $("#tab3" + _eid).hide();
                    $("#tab4" + _eid).hide();
                    $("#tab" + _tab + _eid).show();
                }
                arrow.stop(true, true).animate({
                    left: _tab * obj.width() + "px"
                }, "fast");
            }, 150);
    },
    _LogOut: function () {
        $.ajax({
            url: '/logout.aspx?ajax=0',
            dataType: 'html',
            type: 'POST',
            success: function (data) {
                document.location.reload(true);
            }
        });
    },
    addLayer: function (tid, msg) {
        var mspn = document.createElement("span");
        mspn.style.margin = "4px 2px 4px 34px";
        mspn.style.display = "block";
        mspn.style.fontSize = "12px"
        mspn.style.color = "#3D882D";
        mspn.style.overflow = "hidden";
        mspn.innerHTML = msg;
        var Layer = document.createElement("div");
        Layer.style.background = "url(/images/24h_a006.png) no-repeat 5px center #E8F8E7";
        Layer.style.border = "1px solid #3D882D";
        Layer.style.position = "absolute";
        Layer.style.zIndex = "9999";
        Layer.style.overflow = "hidden";
        Layer.style.height = "auto";
        Layer.id = "LayerMsg";
        Layer.appendChild(mspn);
        if ($(tid).html() == null) {
            Layer.style.top = ($(document).scrollTop() + window.screen.height / 2) - 150 + "px";
            Layer.style.left = window.screen.availWidth / 2 + "px";
            document.body.appendChild(Layer);
        }
        else {
            Layer.style.top = $(tid).offset().top - 50 + "px";
            Layer.style.left = $(tid).width() + $(tid).offset().left - 120 + "px";
            document.body.appendChild(Layer);
        }
        var creatediv = window.setInterval(function () {
            try {
                document.body.removeChild(document.getElementById("LayerMsg"));
            }
            catch (Erorr) { }
            window.clearInterval(creatediv);
        }, 2000);
        return false;
    },
    addLayerWoring: function (tid, msg) {
        var mspn = document.createElement("span");
        mspn.style.margin = "4px 2px 4px 34px";
        mspn.style.display = "block";
        mspn.style.fontSize = "12px"
        mspn.style.color = "#C00";
        mspn.style.overflow = "hidden";
        mspn.innerHTML = msg;
        var Layer = document.createElement("div");
        Layer.style.background = "url(/images/24h_a002.png) no-repeat  5px center #FBE2E2";
        Layer.style.border = "1px solid #C66161 ";
        Layer.style.position = "absolute";
        Layer.style.zIndex = "9999";
        Layer.style.overflow = "hidden";
        Layer.style.height = "auto";
        Layer.id = "LayerMsg";
        Layer.appendChild(mspn);
        if ($(tid).html() == null) {
            Layer.style.top = ($(document).scrollTop() + window.screen.height / 2) - 150 + "px";
            Layer.style.left = window.screen.availWidth / 2 + "px";
            document.body.appendChild(Layer);
        }
        else {
            Layer.style.top = $(tid).offset().top - 40 + "px";
            Layer.style.left = $(tid).width() + $(tid).offset().left - 120 + "px";
            document.body.appendChild(Layer);
        }
        var creatediv = window.setInterval(function () {
            try {
                document.body.removeChild(document.getElementById("LayerMsg"));
            }
            catch (Erorr) { }
            window.clearInterval(creatediv);
        }, 2000);
        return false;
    },
    FavoriteProduct: function (e) {
        var pid = $(e).attr("lang");
        $.ajax({
            type: "POST",
            url: "/controls/proudct.ashx",
            data: "type=fav&favpid=" + pid,
            dataType: 'JSON',
            success: function (data) {
                if (data.msg == "1") {
                    try {
                        $(e).attr("src", function () {
                            return "/images/yes_fav.gif";
                        });
                        _v30.addLayer(e, "收藏成功！");
                    }
                    catch (Error) { }
                }
                else if (data.msg == "0") {
                    _v30.addLayerWoring(e, "收藏失败！");
                }
                else if (data.msg == "-1") {
                    _v30.addLayerWoring(e, "收藏失败，你没有登录！");
                }
                else if (data.msg == "-2") {
                    _v30.addLayerWoring(e, "你已收藏过此商品！");
                }
            }
        });
        //        ProudctAjax("/controls/proudct.ashx", "type=fav&favpid=" + $(this).attr("lang"), 0, this);        
    },
    _gotoTop: function (topborder, speed) {
        var top = 0;
        var _scroll = function () {
            top = $(window).scrollTop();
            $("html,body").animate({
                scrollTop: "0px"
            }, speed);
        }
        var creatBacktopBtn = function () {
            $("body").append("<a href='javascript:;' id='backtotop' class='backtop'>回顶部</a>");
            $(window).scroll(function () {
                if ($(document).scrollTop() >= topborder) {
                    $("#backtotop").fadeIn("fast");
                }
                else {
                    $("#backtotop").fadeOut("fast");
                }
            });
        }
        creatBacktopBtn();
        $(document).on("click", '#backtotop', function () {
            _scroll();
        });
    },
    _openwindow: function (url, name, iWidth, iHeight) {
        var url; //转向网页的地址;
        var name; //网页名称，可为空;
        var iWidth; //弹出窗口的宽度;
        var iHeight; //弹出窗口的高度;
        var iTop = (window.screen.availHeight - 30 - iHeight) / 2; //获得窗口的垂直位置;
        var iLeft = (window.screen.availWidth - 10 - iWidth) / 2; //获得窗口的水平位置;
        window.open(url, name, 'height=' + iHeight + ',,innerHeight=' + iHeight + ',width=' + iWidth + ',innerWidth=' + iWidth + ',top=' + iTop + ',left=' + iLeft + ',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
    },
    //透明度
    Opacity: {
        _over: function (obj) {
            $(obj).css("opacity", "0.7");
        },
        _out: function (obj) {
            $(obj).css("opacity", "1");
        }
    },//End
    _toparTime: function (obj) {
        var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var da = date.getDate();
        var day = date.getDay();
        if (day == 0) day = "星期日"
        if (day == 1) day = "星期一"
        if (day == 2) day = "星期二"
        if (day == 3) day = "星期三"
        if (day == 4) day = "星期四"
        if (day == 5) day = "星期五"
        if (day == 6) day = "星期六"
        var fulldate = "<s></s>今天是：" + year + "年" + month + "月" + da + "日，" + day;
        //document.writeln(fulldate);
        $(obj).html(fulldate);
    },
    _currMenu: function (obj) {
        var getPageName = function (href) {
            var b = href.split("/");
            var c = b.slice(b.length - 1, b.length).toString(String).split(".");
            return c.slice(0, 1);
        }
        var thisPageName = "";
        var urlPageName = getPageName(location.href);
        $(obj).each(function () {
            thisPageName = $(this).find("a").attr("href");
            thisPageName = getPageName(thisPageName);
            if (thisPageName[0] == (urlPageName[0] = urlPageName[0] == "" ? "index" : urlPageName[0]) && $(this).find("a").attr("href").indexOf("store") < 0 && $(this).find("a").attr("href").indexOf("user") < 0) {
                $(this).addClass("curr");
            }
        });
    },
    _plistItemAnimate: function () {
        var obj = $(".productlist_170 ul li");
        var that = null;
        obj.bind("mouseover", function () {
            that = $(this);
            obj.removeClass("curr-dealer curr-self");
            if (that.find(".dealer").length > 0) {
                that.addClass("curr-dealer");
            }
            else {
                that.addClass("curr-self");
            }
        });
        obj.bind("mouseout", function () {
            obj.removeClass("curr-dealer curr-self");
        });
    },//商品列表多商户商品动画
    _getStoreInfo: function () {
        var _storeId = 0;
        var obj = $("#storeinfo-wrap");
        if (typeof (ecstempleStoreid) == "undefined") {
            return;
        }
        else {
            _storeId = ecstempleStoreid;
            if (_storeId != 0) {
                $.ajax({
                    url: '/Store/Controller/StoreManagermentHandler.ashx',
                    type: 'POST',
                    data: {
                        type: "load_store",
                        StoreId: _storeId
                    },
                    dataType: 'json',
                    success: function (data) {
                        //console.log(data);
                        if ($.isPlainObject(data)) {
                            var strVar = "";
                            strVar = '<div class="storeinfo">';
                            strVar += '<div class="storeinfo-mc">';
                            strVar += '<div class="ecs-m storeinfo-base">';
                            strVar += '<div class="storeinfo-mt">店铺信息</div>';
                            strVar += '<div class="storeinfo-smc storeinfo-base-smc">';
                            if (data.storeJson.StoreType == 1)
                                strVar += '<div class="store-zizhi ecs-mb5"><img src="/template/dsp01/images/storeinfo-zizhi.png" /></div>';
                            else
                                strVar += '<div class="store-zizhi ecs-mb5"><img src="/template/dsp01/images/storeinfo-zizhi-gt.png" /></div>';
                            strVar += '<div class="store-name">' + data.storeJson.StoreName + '</div>';
                            strVar += '<div class="store-ratebox">';
                            strVar += '<div class="mt clearfix"><span>综合评分</span><span>评分细则</span></div>';
                            strVar += '<div class="mc clearfix">';
                            strVar += '<div class="score"><b>' + data.storeJson.TotalScore + '</b>分</div>';
                            strVar += '<div class="rate-info">';
                            strVar += '<dl><dt>描述相符：</dt><dd>' + data.storeJson.ScoreDescription + '</dd></dl>';
                            strVar += '<dl><dt>服务态度：</dt><dd>' + data.storeJson.ScoreService + '</dd></dl>';
                            strVar += '<dl><dt>发货速度：</dt><dd>' + data.storeJson.ScoreDeliverySpeed + '</dd></dl>';
                            strVar += '</div></div></div>';
                            strVar += '<dl class="dl"><dt>开店时间：</dt><dd>' + data.storeJson.CreateTime + '</dd></dl>';
                            strVar += '<dl class="dl"><dt>联系人：</dt><dd>' + data.storeJson.ContactorName + '</dd></dl>';
                            strVar += '<dl class="dl"><dt>联系电话：</dt><dd>' + data.storeJson.ContactorMobile + '</dd></dl>';
                            if (data.storeJson.StoreType == 1)
                                strVar += '<dl><dt>公司名称：</dt><dd>' + data.storeCertJson.CompanyName + '</dd></dl>';
                            strVar += '<div class="map-wrap ecs-rel"><dl><dt>地&nbsp;&nbsp;&nbsp;&nbsp;址：</dt><dd>' + data.storeJson.StoreAddress;
                            strVar += '</dd></dl>';
                            if (typeof (loadStoreMap) == "function" && (data.storeJson.StoreAddress.length > 0)) {
                                strVar += '<div class="map-content ecs-abs"><div id="allmap" style="width:100%;height:200px;overflow: hidden;margin:0;display:none;"></div></div>';
                                loadStoreMap(data.storeJson.StoreAddress, data.storeJson.StoreLocationPoint);
                            }
                            strVar += '</div>';
                            strVar += '<div class="bot-btn"><a class="gotostore" href="/StoreIndex.aspx?storeid=' + _storeId + '">进店逛逛</a><a class="favstore" href="javascript:;" onclick="Ecs.ProductInfo.AddStoreFavorite(' + _storeId + ')">收藏店铺</a></div>';
                            strVar += '</div></div>';//店铺基本信息 
                            strVar += '<div class="ecs-m storeinfo-qrcode">';
                            strVar += '<div class="storeinfo-mt">店铺二维码</div>';
                            strVar += '<div class="storeinfo-smc storeinfo-qrcode-smc">';
                            strVar += '<img src="/controls/QRCode.aspx?s=' + data.storeJson.WeixinH5Domain + '&logopath=' + encodeURIComponent(data.storeLogoJson.ImgUrl) + '" />';
                            strVar += '</div></div>';//店铺二维码

                            if (data.storeOnlineJson.length) {
                                Ecs.Tool.Base64.option._keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
                                var storeOnlineJson = decodeURIComponent(Ecs.Tool.Base64.decode(data.storeOnlineJson));
                                strVar += '<div class="ecs-m storeinfo-service">';
                                strVar += '<div class="storeinfo-mt">店铺客服</div>';
                                strVar += '<div class="storeinfo-smc storeinfo-service-smc" id="storeonline">';
                                strVar += "	<ul class=\"store-service-list\">";
                                strVar += storeOnlineJson;
                                strVar += "	<\/ul>";
                                strVar += Ecs.Tool.Base64.decode((data.ThirdJs));
                                //console.log(Ecs.Tool.Base64.decode((data.ThirdJs)));
                            }

                            strVar += '</div></div>';//店铺客服
                            strVar += '</div></div>';//结束
                            obj.show().html(strVar);
                            if (typeof (loadStoreMap) == "function" && (data.storeJson.StoreAddress.length > 0)) {
                                loadStoreMap(data.storeJson.StoreAddress, data.storeJson.StoreLocationPoint);
                            }
                            $(".map-content:first").css("top", $(".map-wrap").outerHeight(true) + "px");
                        }
                    }
                });
            }
        }
    },
}
var onlineService = {
    option: {
        style: "ocs_yellow",
        title: "在线客服",
        content: "",
        onlineside: "left",
        onlineside_width: 400,
        top: 100,
        oday_from: "周一",
        oday_to: "周五",
        otime_from: "09:00",
        otime_to: "17:30",
        hotline: "028-85950000-8878",
        isexpand: "1"
    },
    init: function (opt) {
        //opt = onlineService.option;
        // onlineService.option = opt;
        $.extend(onlineService.option, opt);
        var ecs_os_isshow = "";
        var ecs_os_tkisshow = "";
        if (onlineService.option.isexpand == "1") {
            ecs_os_isshow = "block";
            ecs_os_tkisshow = "none";
        }
        else {
            ecs_os_isshow = "none";
            ecs_os_tkisshow = "block";
        }
        var showhtml = "";
        if (onlineService.option.onlineside != "right" && onlineService.option.onlineside != "left") {
            showhtml =
    "<div id='ecs_os' class='ecs_os  os_style_" + onlineService.option.style + "' style='position:absolute;left:" + onlineService.option.onlineside_width + "px;top:" + onlineService.option.top + "px;display:" + ecs_os_isshow + ";'>" +
"<div class='ecs_os_header'>" +
    "<div class='ecs_os_header_t'><a href='javascript:;' id='ecs_os_tclose' class='close ecs_os_tclose'  title='关闭' >关闭</a></div>" +
    "<div class='online_time'><h3>在线时间</h3>" +
        "<div class='oday'><span class='oday_from'>" + onlineService.option.oday_from + "</span>至<span class='oday_to'>" + onlineService.option.oday_to + "</span></div>" +
        "<div class='otime'><span class='otime_from'>" + onlineService.option.otime_from + "</span>-<span class='otime_to'>" + onlineService.option.otime_to + "</span></div>" +
    "</div>" + //online_time end
"</div>" + //ecs_os_header end
    "<div class='ecs_os_body'>" + onlineService.option.content + "</div>" + //ecs_os_body end
"<div class='ecs_os_footer'>" +
    "<div class='footer_hotline'><span>" + onlineService.option.hotline + "</span></div>" +
    "<div class='footer_close ecs_os_bclose'>关闭在线客服</div>" +
"</div>" + //ecs_os_footer end
"</div>" + //ecs_os
"<div title='点击弹出在线客服' id='ecs_os_tingkao' class='ecs_os_tingkao ecs_os_style_" + onlineService.option.style + "_tk' style='position:absolute;right:" + onlineService.option.onlineside_width + "px;top:" + onlineService.option.top + "px;display:" + ecs_os_tkisshow + "'></div>";
            showhtml +=
            "<div id='ecs_os1' class='ecs_os  os_style_" + onlineService.option.style + "' style='position:absolute;" + onlineService.option.onlineside + ":" + onlineService.option.onlineside_width + "px;top:" + onlineService.option.top + "px;display:" + ecs_os_isshow + ";'>" +
"<div class='ecs_os_header'>" +
    "<div class='ecs_os_header_t'><a href='javascript:;' id='ecs_os_tclose' class='close ecs_os_bclose'  title='关闭' >关闭</a></div>" +
    "<div class='online_time'><h3>在线时间</h3>" +
        "<div class='oday'><span class='oday_from'>" + onlineService.option.oday_from + "</span>至<span class='oday_to'>" + onlineService.option.oday_to + "</span></div>" +
        "<div class='otime'><span class='otime_from'>" + onlineService.option.otime_from + "</span>-<span class='otime_to'>" + onlineService.option.otime_to + "</span></div>" +
    "</div>" + //online_time end
"</div>" + //ecs_os_header end
    "<div class='ecs_os_body'>" + onlineService.option.content + "</div>" + //ecs_os_body end
"<div class='ecs_os_footer'>" +
    "<div class='footer_hotline'><span>" + onlineService.option.hotline + "</span></div>" +
    "<div class='footer_close ecs_os_bclose' id='ecs_os_bclose'>关闭在线客服</div>" +
"</div>" + //ecs_os_footer end
"</div>" + //ecs_os
"<div title='点击弹出在线客服' id='ecs_os_tingkao' class='ecs_os_tingkao ecs_os_style_" + onlineService.option.style + "_tk' style='position:absolute;" + onlineService.option.onlineside + ":" + onlineService.option.onlineside_width + "px;top:" + onlineService.option.top + "px;display:" + ecs_os_tkisshow + "'></div>";
        }
        else {
            showhtml =
    "<div id='ecs_os' class='ecs_os  os_style_" + onlineService.option.style + "' style='position:absolute;" + onlineService.option.onlineside + ":" + onlineService.option.onlineside_width + "px;top:" + onlineService.option.top + "px;display:" + ecs_os_isshow + ";'>" +
"<div class='ecs_os_header'>" +
    "<div class='ecs_os_header_t'><a href='javascript:;' id='ecs_os_tclose' class='ecs_os_tclose close'  title='关闭' >关闭</a></div>" +
    "<div class='online_time'><h3>在线时间</h3>" +
        "<div class='oday'><span class='oday_from'>" + onlineService.option.oday_from + "</span>至<span class='oday_to'>" + onlineService.option.oday_to + "</span></div>" +
        "<div class='otime'><span class='otime_from'>" + onlineService.option.otime_from + "</span>-<span class='otime_to'>" + onlineService.option.otime_to + "</span></div>" +
    "</div>" + //online_time end
"</div>" + //ecs_os_header end
    "<div class='ecs_os_body'>" + onlineService.option.content + "</div>" + //ecs_os_body end
"<div class='ecs_os_footer'>" +
    "<div class='footer_hotline'><span>" + onlineService.option.hotline + "</span></div>" +
    "<div class='footer_close ecs_os_bclose' class='ecs_os_bclose'>关闭在线客服</div>" +
"</div>" + //ecs_os_footer end
"</div>" + //ecs_os
"<div title='点击弹出在线客服' id='ecs_os_tingkao' class='ecs_os_tingkao ecs_os_style_" + onlineService.option.style + "_tk' style='position:absolute;" + onlineService.option.onlineside + ":" + onlineService.option.onlineside_width + "px;top:" + onlineService.option.top + "px;display:" + ecs_os_tkisshow + "'></div>";

        }

        $("body").append(showhtml);
        var ecs_os = $(".ecs_os");
        var ecs_os_tingkao = $(".ecs_os_tingkao");
        var ecs_os_close = $(".ecs_os_tclose,.ecs_os_bclose");

        $(window).scroll(function () {
            if (ecs_os != "undefined" && ecs_os_tingkao != "undefined") {
                ecs_os.stop().animate({
                    top: (parseInt($(this).scrollTop()) + parseInt(onlineService.option.top)) + "px"
                }, 800);
                ecs_os_tingkao.stop().animate({
                    top: (parseInt($(this).scrollTop()) + parseInt(onlineService.option.top)) + "px"
                }, 800);
            }
        });
        if (ecs_os != "undefined" && ecs_os_tingkao != "undefined" && ecs_os_close != "undefined") {
            ecs_os_tingkao.live("click", function () {
                ecs_os_tingkao.hide();
                ecs_os.show();
            }); //显示
            ecs_os_close.live("click", function () {
                ecs_os_tingkao.show();
                ecs_os.hide();
            }); //关闭
        }
    }
}
; (function ($, doc, win, undefind) {
    var spNav = function (element, settings) {
        this.element = element;
        this.$ele = $(this.element);
        this.settings = $.extend({}, spNav.DEFAULTS, settings || {});
        this.init();
    };
    spNav.prototype = {
        init: function () {
            this.event();
        },
        event: function () {
            var that = this;
            $(this.element).on('click.spnav', function (e) {
                var $this = $(this),
                    $closeGroup = $this.nextAll('div[data-role="mg"]'),
                    $menuItem = $('[data-role="mi"]');
                //console.log($this.length);
                if ($closeGroup.length) {
                    if ($closeGroup.is(":visible")) {
                        $closeGroup.hide();
                    } else {
                        $closeGroup.show();
                    }
                    $this.toggleClass('menu-item-active');
                    typeof that.settings.afterCall == 'function' && that.settings.afterCall.call(that);

                }
                e.stopPropagation();
            });
        }
    }
    spNav.prototype.DEFAULTS = {
        afterCall: function () { }
    };
    function Plugin(option) {
        return $(this).each(function () {
            var $this = $(this),
                data = $this.data('spnav'),
                options = $.extend({}, spNav.DEFAULTS, option || {});
            if (!data) {
                $this.data('spnav', (data = new spNav(this, options)));
            }
        });
    }
    $.fn.spnav = Plugin;
})(jQuery, document, window, undefined);
$(document).ready(function () {
    // _v30._tab(".notice_tab .mt a", ".notice_tab .mc ul", "mouseover", 300); //newstab
    _v30._showHide($("#topmenu_more"), $("#topmenu_more .submenu"), 200, "fast", "slidedown"); //menu more
    //_v30._showHide($("#m_order"), $("#m_order .dt"), 200, "fast", "slidedown"); //
    //_v30._showHide($("#m_service"), $("#m_service .dt"), 200, "fast", "slidedown"); //
    _v30._showHide($("#my366buy"), $("#my366buy dd"), 200, "fast", "slidedown"); //menu more
    _v30._showHide($(".nav .categorys"), $(".nav .categorys .mc"), 200, 500, "slidedown"); //topcategory

    $(".v29slider").each(function () {
        var t = $(this);
        var effect = t.attr("effect");
        var isShowNum = t.attr("isShowNum");
        _v30.normalSlider(t, "click", effect, true, 3000, isShowNum);
    }); //nomral slider

    $(".v29jcslider").each(function () {
        var t = $(this);
        _v30._jcSlider(t, 3, t.find(".prev"), t.find(".next"));
    }); //jcSlider

    $("#top_adimg").each(function () {
        var t = $(this);
        _v30._topAd(t, t.attr("showtime"), $(this).attr("imgheight"));
    }); //top adv img

    _v30._gotoTop(100, 200); //go to top

    $(".notice_tab,.notice_tabs").each(function () {
        var t = $(this);
        _v30._tab(t.find(".mt a"), t.find(".mc ul"), "mouseover", 300); //newstab
        _v30._synHeight(t.find(".mc ul"));
    });

    $(".category").each(function () {
        $(this).find(".category_right").css({ "height": $(this).find(".category_left").height() + "px" });
    });
    _v30._categories._init();

    $.each($(".floor"), function (e) {
        $(this).find(".floor_num").text(e + 1 + "F");
    });

    _v30._changeImg("#ScrCont .pic", "click");
    _v30._currMenu(".menu ul li");
    _v30._plistItemAnimate();
    _v30._getStoreInfo();
    $('.menu-item').spnav({
        afterCall: function () {
            alert(11);
        }
    });
});
